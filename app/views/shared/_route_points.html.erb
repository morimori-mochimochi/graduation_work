
<div class="point-selector flex flex-wrap items-center justify-center w-full">
  <%# 'mode'ローカル変数に応じて表示を切り替える %>
  <% if defined?(mode) && mode == :walk %>
    <%= link_to car_routes_path do %>
      <%= image_tag "/images/how_to_go_walk.png", alt: "go_walk", class: "btn_effect h-18" %>
    <% end %>
  <% else %>
    <%= link_to walk_routes_path do %>
      <%= image_tag "/images/how_to_go_car.png", alt: "go_to_car", class: "btn_effect h-18" %>
    <% end %>
  <% end %>

  <div class="flex flex-col gap-1 -mt-5">
    <button id="startPoint" onclick="alert('検索、または地図上から出発点を選択してください。')" class="self-center btn_effect px-4 py-2 bg-white border-none rounded-md shadow-md font-bold text-gray-500">現在地</button>
    <div class="flex items-center gap-1">
      <select id="startHour" class="select select-bordered select-sm w-20 bg-white border-none rounded-md shadow-md text-gray-500">
        <option disabled selected>時</option>
        <% (0..23).each do |h| %>
          <option><%= format('%02d', h) %></option>
        <% end %>
      </select>
      <select id="startMinute"class="select select-bordered select-sm w-20 bg-white border-none rounded-md shadow-md text-gray-500">
        <option disabled selected>分</option>
        <% (0..59).step(1).each do |m| %>
          <option><%= format('%02d', m) %></option>
        <% end %>
      </select>
      <span class="font-bold text-[#624007]">発</span>
    </div>
  </div>

  <!-- 中継点はこのコンテナの中にJavaScriptによって動的に追加される -->
  <div id="relayPointsContainer" class="flex flex-col items-center justify-center gap-4"></div>

  <!-- 中継点要素のひな形 -->
  <template id="relay-point-template">
    <div class="relay-point-item flex flex-col items-center justify-center gap-2">
      <%= image_tag "/images/arrow.png", alt: "arrow", class: "h-5 w-auto" %>
      <button class="relay-point-name btn_effect px-4 py-2 bg-white border-none rounded-md shadow-md font-bold text-gray-500">中継地</button>
      <div class="flex items-center gap-1">
        <div class="flex flex-col">
          <span class="relay-arrival-time"></span>
        </div>
        <div class="flex flex-col gap-1">
          <span class="font-bold text-[#624007]">滞在時間</span>
          <div class="flex items-center -mt-1">
            <select id="stayHour_${index}" class="stay-hour-select select select-bordered select-sm w-20 bg-white border-none rounded-md shadow-md text-gray-500"
                    data-options="<%= options_for_select((0..23).map { |h| format('%02d', h) }).to_json %>"></select>
            <select id="stayMinute_${index}" class="stay-minute-select select select-bordered select-sm w-20 bg-white border-none rounded-md shadow-md text-gray-500"
                    data-options="<%= options_for_select((0..59).map { |m| format('%02d', m) }).to_json %>"></select>
            <span class="font-bold text-[#624007]">中継点<br>(着)</span>
          </div> 
        </div>

        <div class="flex flex-col gap-1">
          <button class="remove-relay-point-btn text-red-500 text-xl btn_effect bg-white border-none rounded-md shadow-md font-bold w-6 h-6 flex items-center justify-center p-0">×</button>
          <div class="flex flex-col gap-1">
            <% if local_assigns.fetch(:mode, nil) == :car %>
              <button class="search-nearby-parking-btn appearance-none bg-transparent border-none" data-point-type="relay">
                <%= image_tag "/images/search_parking.png", alt: "search_parking", class: "btn_effect h-13 w-13" %>
              </button>
            <% end %>
            <div class="parking-info text-xs text-gray-600"></div>
          </div>
        </div>
      </div>
    </div>
  </template>

  <%= image_tag "/images/arrow.png", alt: "arrow", class: "h-5 -mt-4 w-auto" %>
  <div class="flex flex-col">
    <button id="destinationPoint" onclick="alert('検索、または地図上から目的地を選択してください。')" class="self-center btn_effect px-4 py-2 -mt-2 bg-white border-none rounded-md shadow-md font-bold text-gray-500">目的地</button>
    <div class="flex items-center gap-1">
      <div class="flex items-center gap-1 -mt-7">
        <select id="destinationHour" class="select select-bordered select-sm w-20 bg-white border-none rounded-md shadow-md text-gray-500">
          <option disabled selected>時</option>
          <% (0..23).each do |h| %>
            <option><%= format('%02d', h) %></option>
          <% end %>
        </select>
        <select id="destinationMinute" class="select select-bordered select-sm w-20 bg-white border-none rounded-md shadow-md text-gray-500">
          <option disabled selected>分</option>
          <% (0..59).step(1).each do |m| %>
            <option><%= format('%02d', m) %></option>
          <% end %>
        </select>
        <span class="font-bold text-[#624007]">着</span>
      </div>
      <% if local_assigns.fetch(:mode, nil) == :car %>
        <button class="search-nearby-parking-btn appearance-none bg-transparent border-none" data-point-type="destination">
          <%= image_tag "/images/search_parking.png", alt: "search_parking", class: "btn_effect mt-2 h-13 w-13" %>
        </button>
      <% end %>
    </div>
    <div id="destinationParkingInfo" class="text-xs text-gray-600 text-center mt-1"></div>
  </div>
</div>

<template id="parking-info-window-template">
  <div style="min-width:200px">
    <div class="parking-info-window-name" style="font-weight:bold;"></div>
    <div class="parking-info-window-address" style="font-size:0.9em;color:#555;margin-bottom:8px;"></div>
    <button class="set-parking-btn btn btn-sm btn-primary">ここに駐車する</button>
  </div>
</template>