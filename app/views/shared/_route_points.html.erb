<div class="point-selector flex flex-wrap items-center justify-center gap-2">
  <div class="flex flex-col gap-1">
    <button id="startPoint" class="btn_effect px-4 py-2 bg-white border-3 border-[#9A6812] rounded-md shadow-md font-bold">出発地</button>
    <div class="flex flex-col gap-1">
      <span class="font-bold text-[#624007]">出発</span>
      <select id="startHour" class="select select-bordered select-sm w-20 bg-white border-[#9A6812]">
        <option disabled selected>時</option>
        <% (0..23).each do |h| %>
          <option><%= format('%02d', h) %></option>
        <% end %>
      </select>
      <select id="startMinute"class="select select-bordered select-sm w-20 bg-white border-[#9A6812]">
        <option disabled selected>分</option>
        <% (0..59).step(1).each do |m| %>
          <option><%= format('%02d', m) %></option>
        <% end %>
      </select>
    </div>
  </div>

  <!-- 中継点はこのコンテナの中にJavaScriptによって動的に追加される -->
  <div id="relayPointsContainer" class="flex flex-col items-center justify-center gap-4"></div>

  <!-- 中継点要素のひな形 -->
  <template id="relay-point-template">
    <div class="relay-point-item flex flex-col items-center justify-center gap-2">
      <%= image_tag "/images/arrow.png", alt: "arrow", class: "h-5 w-auto" %>
      <button class="relay-point-name btn_effect px-4 py-2 bg-white border-3 border-[#9A6812] rounded-md shadow-md font-bold">中継地</button>
      <div class="flex items-center gap-1">
        <div class="flex items-center gap-1">
          <div class="flex flex-col gap-1">
            <span class="font-bold text-[#624007]">中継点到着</span>
            <select id="relayArrivalHour_${index}" class="relay-hour-select select select-bordered select-sm w-20 bg-white border-[#9A6812]" disabled
                    data-options="<%= options_for_select((0..23).map { |h| format('%02d', h) }).to_json %>"></select>
            <select id="relayArrivalMinute_${index}" class="relay-minute-select select select-bordered select-sm w-20 bg-white border-[#9A6812]" disabled
                    data-options="<%= options_for_select((0..59).map { |m| format('%02d', m) }).to_json %>"></select>
          </div>
          <div class="flex flex-col gap-1">
            <span class="font-bold text-[#624007]">滞在時間</span>
            <select id="stayHour_${index}" class="stay-hour-select select select-bordered select-sm w-20 bg-white border-[#9A6812]"
                    data-options="<%= options_for_select((0..23).map { |h| format('%02d', h) }).to_json %>"></select>
            <select id="stayMinute_${index}" class="stay-minute-select select select-bordered select-sm w-20 bg-white border-[#9A6812]"
                    data-options="<%= options_for_select((0..59).map { |m| format('%02d', m) }).to_json %>"></select>
          </div>
          <div class="flex flex-col gap-1">
            <span class="font-bold text-[#624007]">中継点出発</span>
            <select id="relayDeptHour_${index}" class="relay-dept-hour-select select select-bordered select-sm w-20 bg-white border-[#9A6812]" disabled
                    data-options="<%= options_for_select((0..23).map { |h| format('%02d', h) }).to_json %>"></select>
            <select id="relayDeptMinute_${index}" class="relay-dept-minute-select select select-bordered select-sm w-20 bg-white border-[#9A6812]" disabled
                    data-options="<%= options_for_select((0..59).map { |m| format('%02d', m) }).to_json %>"></select>
          </div>
          <div class="flex flex-col gap-1">
            <button class="remove-relay-point-btn text-red-500 text-xl btn_effect bg-white border-3 border-[#9A6812] rounded-md shadow-md font-bold w-6 h-6 flex items-center justify-center p-0">×</button>
            <% if local_assigns.fetch(:mode, nil) == :car %>
              <button class="search-nearby-parking-btn appearance-none bg-transparent border-none" data-point-type="relay">
                <%= image_tag "/images/search_parking.png", alt: "search_parking", class: "btn_effect mt-2 h-13 w-13" %>
              </button>
            <% end %>
          </div>
        </div>
      </div>
      <div class="parking-info text-xs text-gray-600"></div>
    </div>
  </template>

  <%= image_tag "/images/arrow.png", alt: "arrow", class: "mb-1 h-5 w-auto" %>
  <div class="flex flex-col gap-1">
    <button id="destinationPoint" class="btn_effect px-4 py-2 bg-white border-3 border-[#9A6812] rounded-md shadow-md font-bold">目的地</button>
    <div class="flex items-center gap-2">
      <div class="flex flex-col gap-1">
        <span class="font-bold text-[#624007]">到着</span>
        <select id="destinationHour" class="select select-bordered select-sm w-20 bg-white border-[#9A6812]">
          <option disabled selected>時</option>
          <% (0..23).each do |h| %>
            <option><%= format('%02d', h) %></option>
          <% end %>
        </select>
        <select id="destinationMinute" class="select select-bordered select-sm w-20 bg-white border-[#9A6812]">
          <option disabled selected>分</option>
          <% (0..59).step(1).each do |m| %>
            <option><%= format('%02d', m) %></option>
          <% end %>
        </select>
      </div>
      <% if local_assigns.fetch(:mode, nil) == :car %>
        <button class="search-nearby-parking-btn appearance-none bg-transparent border-none" data-point-type="destination">
          <%= image_tag "/images/search_parking.png", alt: "search_parking", class: "btn_effect mt-2 h-13 w-13" %>
        </button>
      <% end %>
    </div>
    <div id="destinationParkingInfo" class="text-xs text-gray-600 text-center mt-1"></div>
  </div>
</div>

<template id="parking-info-window-template">
  <div style="min-width:200px">
    <div class="parking-info-window-name" style="font-weight:bold;"></div>
    <div class="parking-info-window-address" style="font-size:0.9em;color:#555;margin-bottom:8px;"></div>
    <button class="set-parking-btn btn btn-sm btn-primary">ここに駐車する</button>
  </div>
</template>