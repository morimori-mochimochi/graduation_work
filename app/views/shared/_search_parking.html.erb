<script>
// #getCenter()で地図の中心緯度経度を取得、radius: 2000は検索範囲を2kmに指定、query:"parking"は施設の種類を駐車場に指定
  async function searchParking(){
    const center = window.map.getCenter();
    try {
      const places = await google.maps.importLibrary("places");
      const request = {
        textQuery: "parking",
        locationBias: {
          circle: { center: center, radius: 2000 }
        },
        fields: ["displayName", "location", "id"]
      };

  
      const response = await places.Place.searchByText(request);

      response.results.forEach(place => {
        new google.maps.Marker({
          map: window.map,
          position: place.location,
          title: place.displayName,
        });
      });
    } catch (error) {
      alert("駐車場の検索に失敗しました: " + error.message);
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("searchNearby");
    if (btn) {
      btn.addEventListener("click", searchParking);
    }
  });
</script>