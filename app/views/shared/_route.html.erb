<script>
  async function drawRoute(){
    console.log("マップの読み込みを待っています");
    await window.mapApiLoaded;
    console.log("window.map: ", window.map);

    // #DirectionsAPIで使うオブジェクトの生成
    const directionsService = new google.maps.DirectionsService();
    // #取得したルートをマップに表示
    const directionsRenderer = new google.maps.DirectionsRenderer();
    // #どのマップにルートを描画するかを指定
    directionsRenderer.setMap(map);

    console.log("ルート描画の準備ができました");

    directionsService.route(
      {
        origin: "東京駅",
        destination: "浅草寺",
        waypoints: [
          { location: "上野駅", stopover: true },
          { location: "秋葉原駅", stopover: true }
        ],
        optimizeWaypoints: true,
        travelMode: google.maps.TravelMode.DRIVING
      },
      (response, status) => {
        if (status === "OK"){
          directionsRenderer.setDirections(response);
        } else {
          alert("ルートの取得に失敗しました: " + status);
        }
      }
    );
  }

  document.addEventListener("DOMContentLoaded", () => {
    const drawRouteBtn = document.getElementById("drawRoute");
    drawRouteBtn.addEventListener("click", () => {
      drawRoute();
    });
  });
</script>