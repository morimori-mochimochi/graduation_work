<script>
  document.addEventListener("DOMContentLoaded", async () => {
    console.log("mapsReady1")
    // #マップの生成完了まで待機
    await window.mapsReady;
    
    // #生成済みマップを取得
    const map = window.map;
    console.log("mapsReady2")

    if (!map) {
      console.warn("地図が読み込まれていません");
      return;
    }

    // #マーカーが無い、という初期状態を作る
    let selectedMarker = null;

    // #マップクリックでマーカー配置
    window.map.addListener("click", (event) => {
      console.log("mapsReady3")
    // #既存のマーカーを削除
      if (selectedMarker) {
        selectedMarker.setMap(null);
      }

    // #新しいマーカーを配置
      selectedMarker = new google.maps.Marker({
        position: event.latLng,
        map: map,
        title: "選択地点"
      });
    
    // #検索用に座標を保存
      window.searchCenter = event.latLng;
    });
  });
</script>