<script>
  // #window.mapが書き換えられる瞬間を監視するデバッグコード
  // #Object.defineProperty(window, "map", {
    // #set(value) {
      // #console.log("⚡️window.mapが書き換えられました: ", value?.constructor?.name, value);
      // #this._map = value;
    // #},
    // #get() {
      // #return this._map;
    // #}
  // #});
  // #MapsAPIが呼ばれたことを保つためのPromise
  // #Google Maps APIがinitMapを読んだらresolveが実行、resolveされるとGoogleMapsAPIの準備ができた合図
  // #resolve()が呼ばれた時点でAPIの準備完了となり、次のコードが実行される
  window.mapApiLoaded = new Promise((resolve) => {
    if (window.google && window.google.maps) {
      resolve(); // #APIが読み込まれている時はすぐに解決
    } else {
      const originalInitMap = window.initMap;  // #元のinitMap関数を保存(上書きしても元の処理が消えないように)
      window.initMap = () => {
        console.log("initMapがオリジナルに上書きされました");
        // #typeofは指定した値のデータ型を調べ、文字列で返す
        if (typeof originalInitMap === 'function') {
          originalInitMap();
        }
        resolve();
      };
    }
  });
  window.mapApiLoaded.then(() => console.log("mapsReadyがresolve"));
</script>